import{d as e,g as s,y as a,k as l,z as t,q as o,o as c,c as u,w as n,u as r,h as d,a as i,b as f,F as p,r as _,n as m,s as g,t as k,A as v,B as b,C as x,e as h,f as y,i as w,j as C,m as I,p as j,D as B,S as A,E as S}from"./index-5ec5936b.js";import{g as V,p as F,d as E,a as P,_ as R}from"./cart.ee0350cb.js";import{_ as T,a as U}from"./uni-swipe-action.21c44c35.js";import{u as q,_ as z}from"./index.b2979765.js";import{_ as D}from"./_plugin-vue_export-helper.1b428a4d.js";const G=D(e({__name:"CartMain",props:{safeAreaInsetBottom:{type:Boolean}},setup(e){const{safeAreaInsets:D}=s(),G=a(),M=l([]),O=l(!0),X=async()=>{const e=await V();M.value=e.result,O.value=e.result.length>0};t((()=>{G.profile&&X()}));const $=e=>{P(e.index,{count:e.value})},H=o((()=>M.value.length&&M.value.every((e=>e.selected)))),J=()=>{const e=!H.value;M.value.forEach((s=>{s.selected=e})),F({selected:e})},K=o((()=>M.value.filter((e=>e.selected)))),L=o((()=>K.value.reduce(((e,s)=>e+s.count),0))),N=o((()=>K.value.reduce(((e,s)=>e+s.count*s.nowPrice),0).toFixed(2))),Q=()=>{if(0===L.value)return b({icon:"none",title:"请选择商品"});x({url:"/pagesOrder/create/create"})},{guessRef:W,onScrolltolower:Y}=q();return(s,a)=>{const l=h,t=y,o=w,b=C,x=I(j("vk-data-input-number-box"),R),V=B,F=I(j("uni-swipe-action-item"),T),q=I(j("uni-swipe-action"),U),K=I(j("XtxGuess"),z),Z=A;return c(),u(Z,{"enable-back-to-top":"","scroll-y":"",class:"scroll-view",onScrolltolower:r(Y)},{default:n((()=>{var s;return[r(G).profile?(c(),d(p,{key:0},[O.value?(c(),u(t,{key:0,class:"cart-list"},{default:n((()=>[i(t,{class:"tips"},{default:n((()=>[i(l,{class:"label"},{default:n((()=>[f("满减")])),_:1}),i(l,{class:"desc"},{default:n((()=>[f("满1件, 即可享受9折优惠")])),_:1})])),_:1}),i(q,null,{default:n((()=>[(c(!0),d(p,null,_(M.value,(e=>(c(),u(F,{key:e.skuId,class:"cart-swipe"},{right:n((()=>[i(t,{class:"cart-swipe-right"},{default:n((()=>[i(V,{onClick:s=>{return a=e.skuId,void S({content:"是否删除",confirmColor:"#27BA9B",success:async e=>{e.confirm&&(await E({ids:[a]}),X())}});var a},class:"button delete-button"},{default:n((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),default:n((()=>[i(t,{class:"goods"},{default:n((()=>[i(l,{onClick:s=>(e=>{e.selected=!e.selected,P(e.skuId,{selected:e.selected})})(e),class:g(["checkbox",{checked:e.selected}])},null,8,["onClick","class"]),i(b,{url:`/pages/goods/goods?id=${e.id}`,"hover-class":"none",class:"navigator"},{default:n((()=>[i(o,{mode:"aspectFill",class:"picture",src:e.picture},null,8,["src"]),i(t,{class:"meta"},{default:n((()=>[i(t,{class:"name ellipsis"},{default:n((()=>[f(k(e.name),1)])),_:2},1024),i(t,{class:"attrsText ellipsis"},{default:n((()=>[f(k(e.attrsText),1)])),_:2},1024),i(t,{class:"price"},{default:n((()=>[f(k(e.nowPrice),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["url"]),i(t,{class:"count"},{default:n((()=>[i(x,{modelValue:e.count,"onUpdate:modelValue":s=>e.count=s,min:1,max:e.stock,index:e.skuId,onChange:$},null,8,["modelValue","onUpdate:modelValue","max","index"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):(c(),u(t,{key:1,class:"cart-blank"},{default:n((()=>[i(o,{src:"./static/images/blank_cart.png",class:"image"}),i(l,{class:"text"},{default:n((()=>[f("购物车还是空的，快来挑选好货吧")])),_:1}),i(b,{url:"/pages/index/index","hover-class":"none"},{default:n((()=>[i(V,{class:"button"},{default:n((()=>[f("去首页看看")])),_:1})])),_:1})])),_:1})),O.value?(c(),u(t,{key:2,class:"toolbar",style:m({paddingBottom:e.safeAreaInsetBottom?(null==(s=r(D))?void 0:s.bottom)+"px":0})},{default:n((()=>[i(l,{onClick:J,class:g(["all",{checked:r(H)}])},{default:n((()=>[f("全选")])),_:1},8,["class"]),i(l,{class:"text"},{default:n((()=>[f("合计:")])),_:1}),i(l,{class:"amount"},{default:n((()=>[f(k(r(N)),1)])),_:1}),i(t,{class:"button-grounp"},{default:n((()=>[i(t,{onClick:Q,class:g(["button payment-button",{disabled:0===r(L)}])},{default:n((()=>[f(" 去结算("+k(r(L))+") ",1)])),_:1},8,["class"])])),_:1})])),_:1},8,["style"])):v("",!0)],64)):(c(),u(t,{key:1,class:"login-blank"},{default:n((()=>[i(l,{class:"text"},{default:n((()=>[f("登录后可查看购物车中的商品")])),_:1}),i(b,{url:"/pages/login/login","hover-class":"none"},{default:n((()=>[i(V,{class:"button"},{default:n((()=>[f("去登录")])),_:1})])),_:1})])),_:1})),i(K,{ref_key:"guessRef",ref:W},null,512),i(t,{class:"toolbar-height"})]})),_:1},8,["onScrolltolower"])}}}),[["__scopeId","data-v-5311b70f"]]);export{G as C};
